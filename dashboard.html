<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">

<title>Dashboard Financeiro</title>

<meta name="viewport"
      content="width=device-width,
               initial-scale=1,
               maximum-scale=1,
               user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<!-- FLATPICKR (RANGE) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>

<!-- CHART -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root{
  --bg:#0b0b0b;
  --card:#151515;
  --border:#242424;

  --gold:#d4af37;
  --green:#22c55e;
  --red:#ef4444;

  --text:#f5f5f5;
  --muted:#9ca3af;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:Inter}

html,body{
  width:100%;
  height:100%;
  background:var(--bg);
  color:var(--text);
  overflow:auto;
  scrollbar-width:none;
}
body::-webkit-scrollbar{display:none}

/* HEADER */
.header{padding:16px}
.header h2{font-size:18px;font-weight:800}
.header span{font-size:12px;color:var(--muted)}

/* FILTROS */
.filters{
  padding:0 16px 16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

select,input,button{
  padding:12px;
  border-radius:12px;
  background:#0b0b0b;
  border:1px solid var(--border);
  color:var(--text);
  font-size:13px;
}

.filtro-periodo{
  display:grid;
  grid-template-columns:1fr auto;
  gap:8px;
}

.btn-limpar{
  background:#1a1a1a;
  color:var(--muted);
  font-weight:700;
  padding:0 14px;
  cursor:pointer;
}

/* GRAFICO */
.chart-box{
  margin:0 16px 16px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:12px;
}
.chart-box h3{
  font-size:13px;
  color:var(--muted);
  margin-bottom:8px;
}

/* CARDS */
.cards{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  padding:0 16px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
}
.card .label{font-size:12px;color:var(--muted)}
.card .value{font-size:22px;font-weight:800;margin-top:6px}
.total{color:var(--gold)}
.entrada{color:var(--green)}
.saida{color:var(--red)}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <h2>Dashboard Financeiro</h2>
  <span>Relatório multi-empresas</span>
</div>

<!-- FILTROS -->
<div class="filters">

  <!-- EMPRESA -->
  <select id="empresa">
    <option value="todas">Todas as empresas</option>
    <option value="Grupo DV">Grupo DV</option>
    <option value="Empresa A">Empresa A</option>
    <option value="Empresa B">Empresa B</option>
  </select>

  <!-- PERÍODO + LIMPAR -->
  <div class="filtro-periodo">
    <input id="periodo" placeholder="Período (dd/mm/aaaa)">
    <button class="btn-limpar" onclick="limparFiltros()">Limpar</button>
  </div>
</div>

<!-- GRAFICO -->
<div class="chart-box">
  <h3>Evolução de ganhos e gastos</h3>
  <canvas id="grafico" height="180"></canvas>
</div>

<!-- CARDS -->
<div class="cards">
  <div class="card">
    <div class="label">Resultado</div>
    <div class="value total" id="resultado">R$ 0,00</div>
  </div>

  <div class="card">
    <div class="label">Entradas</div>
    <div class="value entrada" id="entradas">R$ 0,00</div>
  </div>

  <div class="card">
    <div class="label">Saídas</div>
    <div class="value saida" id="saidas">R$ 0,00</div>
  </div>
</div>

<script>
/* ===== MOCK (SUPABASE DEPOIS) ===== */
const dados = [
  {empresa:'Grupo DV', data:'2024-06-01', entrada:1200, saida:400},
  {empresa:'Grupo DV', data:'2024-06-02', entrada:1800, saida:600},
  {empresa:'Empresa A', data:'2024-06-03', entrada:1500, saida:300},
  {empresa:'Empresa B', data:'2024-06-04', entrada:2200, saida:900},
  {empresa:'Grupo DV', data:'2024-06-05', entrada:2600, saida:1100}
];

let chart;
let dataInicio = null;
let dataFim = null;

/* ===== EMPRESA GLOBAL ===== */
const empresaSelect = document.getElementById("empresa");
const empresaSalva = localStorage.getItem("EMPRESA_ATIVA");

if(empresaSalva){
  empresaSelect.value = empresaSalva;
}

empresaSelect.addEventListener("change", ()=>{
  localStorage.setItem("EMPRESA_ATIVA", empresaSelect.value);
  aplicarFiltros();
});

/* ===== CALENDÁRIO RANGE (DD/MM/AAAA) ===== */
const picker = flatpickr("#periodo",{
  mode:"range",
  dateFormat:"d/m/Y",
  locale:flatpickr.l10ns.pt,
  onClose:(datas)=>{
    if(datas.length === 2){
      dataInicio = datas[0].toISOString().split("T")[0];
      dataFim = datas[1].toISOString().split("T")[0];
      aplicarFiltros();
    }
  }
});

/* ===== LIMPAR ===== */
function limparFiltros(){
  dataInicio = null;
  dataFim = null;
  picker.clear();
  aplicarFiltros();
}

/* ===== FILTRO ===== */
function aplicarFiltros(){
  const emp = empresaSelect.value;

  const filtrado = dados.filter(d =>
    (emp === "todas" || d.empresa === emp) &&
    (!dataInicio || d.data >= dataInicio) &&
    (!dataFim || d.data <= dataFim)
  );

  atualizarDashboard(filtrado);
}

/* ===== DASHBOARD ===== */
function atualizarDashboard(lista){
  let ent = 0, sai = 0;
  const labels=[], entradas=[], saidas=[];

  lista.forEach(d=>{
    ent += d.entrada;
    sai += d.saida;
    labels.push(d.data.split("-").reverse().join("/"));
    entradas.push(d.entrada);
    saidas.push(d.saida);
  });

  resultado.innerText = `R$ ${(ent-sai).toLocaleString("pt-BR")}`;
  entradasEl.innerText = `R$ ${ent.toLocaleString("pt-BR")}`;
  saidasEl.innerText = `R$ ${sai.toLocaleString("pt-BR")}`;

  if(chart) chart.destroy();

  chart = new Chart(grafico,{
    type:"line",
    data:{
      labels,
      datasets:[
        {
          label:"Entradas",
          data:entradas,
          borderColor:"#22c55e",
          backgroundColor:"rgba(34,197,94,.15)",
          tension:.4
        },
        {
          label:"Saídas",
          data:saidas,
          borderColor:"#ef4444",
          backgroundColor:"rgba(239,68,68,.15)",
          tension:.4
        }
      ]
    },
    options:{
      plugins:{legend:{labels:{color:"#f5f5f5"}}},
      scales:{
        x:{ticks:{color:"#9ca3af"}},
        y:{ticks:{color:"#9ca3af"}}
      }
    }
  });
}

const resultado=document.getElementById("resultado");
const entradasEl=document.getElementById("entradas");
const saidasEl=document.getElementById("saidas");

/* INIT */
aplicarFiltros();
</script>

</body>
</html>
