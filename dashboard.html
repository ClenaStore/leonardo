<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">

<title>Dashboard Financeiro</title>

<meta name="viewport"
      content="width=device-width,
               initial-scale=1,
               maximum-scale=1,
               user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root{
  --bg:#0b0b0b;
  --card:#151515;
  --border:#242424;

  --gold:#d4af37;
  --green:#22c55e;
  --red:#ef4444;

  --text:#f5f5f5;
  --muted:#9ca3af;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Inter,system-ui;
}

html,body{
  width:100%;
  height:100%;
  background:var(--bg);
  color:var(--text);
  overflow:auto;
  scrollbar-width:none;
}
body::-webkit-scrollbar{display:none}

/* HEADER */
.header{
  padding:16px;
}
.header h2{
  font-size:18px;
  font-weight:800;
}
.header span{
  font-size:12px;
  color:var(--muted);
}

/* FILTROS */
.filters{
  padding:0 16px 16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.filters select{
  padding:12px;
  border-radius:12px;
  background:#0b0b0b;
  border:1px solid var(--border);
  color:var(--text);
}

/* PERÍODO (UM BLOCO) */
.periodo{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.periodo input{
  padding:12px;
  border-radius:12px;
  background:#0b0b0b;
  border:1px solid var(--border);
  color:var(--text);
}

.btn-aplicar{
  padding:12px;
  border-radius:14px;
  border:none;
  font-weight:800;
  background:var(--gold);
  color:#000;
  cursor:pointer;
}

/* GRAFICO */
.chart-box{
  margin:0 16px 16px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:12px;
}
.chart-box h3{
  font-size:13px;
  margin-bottom:8px;
  color:var(--muted);
}

/* CARDS */
.cards{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  padding:0 16px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
}
.card .label{
  font-size:12px;
  color:var(--muted);
}
.card .value{
  font-size:22px;
  font-weight:800;
  margin-top:6px;
}
.total{color:var(--gold)}
.entrada{color:var(--green)}
.saida{color:var(--red)}

/* LISTA */
.list{
  padding:16px;
}
.list h3{
  font-size:14px;
  margin-bottom:8px;
}
.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px 14px;
  margin-bottom:8px;
}
.item strong{font-size:13px}
.item span{font-size:11px;color:var(--muted)}
.item .valor{font-weight:700}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <h2>Dashboard Financeiro</h2>
  <span>Relatório multi-empresas</span>
</div>

<!-- FILTROS -->
<div class="filters">

  <select id="empresa">
    <option value="todas">Todas as empresas</option>
    <option value="Grupo DV">Grupo DV</option>
    <option value="Empresa A">Empresa A</option>
    <option value="Empresa B">Empresa B</option>
  </select>

  <div class="periodo">
    <input type="date" id="dataInicio">
    <input type="date" id="dataFim">
  </div>

  <button class="btn-aplicar" onclick="aplicarFiltros()">Aplicar filtros</button>
</div>

<!-- GRAFICO (LOGO ABAIXO DOS FILTROS) -->
<div class="chart-box">
  <h3>Evolução de ganhos e gastos</h3>
  <canvas id="grafico" height="180"></canvas>
</div>

<!-- CARDS -->
<div class="cards">
  <div class="card">
    <div class="label">Resultado</div>
    <div class="value total" id="resultado">R$ 0,00</div>
  </div>

  <div class="card">
    <div class="label">Entradas</div>
    <div class="value entrada" id="entradas">R$ 0,00</div>
  </div>

  <div class="card">
    <div class="label">Saídas</div>
    <div class="value saida" id="saidas">R$ 0,00</div>
  </div>
</div>

<!-- LISTA -->
<div class="list">
  <h3>Resumo por empresa</h3>

  <div class="item">
    <div>
      <strong>Grupo DV</strong><br>
      <span>Período filtrado</span>
    </div>
    <div class="valor total">R$ 58.200,00</div>
  </div>
</div>

<script>
/* ===== MOCK DE DADOS (SUPABASE ENTRA DEPOIS) ===== */
const dados = [
  {empresa:'Grupo DV', data:'2024-06-01', entrada:1200, saida:400},
  {empresa:'Grupo DV', data:'2024-06-02', entrada:1800, saida:600},
  {empresa:'Empresa A', data:'2024-06-03', entrada:1500, saida:300},
  {empresa:'Empresa B', data:'2024-06-04', entrada:2200, saida:900},
  {empresa:'Grupo DV', data:'2024-06-05', entrada:2600, saida:1100}
];

let chart;

/* ===== APLICA FILTROS ===== */
function aplicarFiltros(){
  const emp = empresa.value;
  const ini = dataInicio.value;
  const fim = dataFim.value;

  const filtrado = dados.filter(d =>
    (emp === 'todas' || d.empresa === emp) &&
    (!ini || d.data >= ini) &&
    (!fim || d.data <= fim)
  );

  atualizarDashboard(filtrado);
}

/* ===== ATUALIZA DASHBOARD ===== */
function atualizarDashboard(lista){
  let totalEntradas = 0;
  let totalSaidas = 0;

  const labels = [];
  const entradas = [];
  const saidas = [];

  lista.forEach(d=>{
    totalEntradas += d.entrada;
    totalSaidas += d.saida;
    labels.push(d.data.split('-').reverse().join('/'));
    entradas.push(d.entrada);
    saidas.push(d.saida);
  });

  resultado.innerText = `R$ ${(totalEntradas - totalSaidas).toLocaleString('pt-BR')}`;
  entradas.innerText = `R$ ${totalEntradas.toLocaleString('pt-BR')}`;
  saidas.innerText = `R$ ${totalSaidas.toLocaleString('pt-BR')}`;

  if(chart) chart.destroy();

  chart = new Chart(grafico,{
    type:'line',
    data:{
      labels,
      datasets:[
        {
          label:'Entradas',
          data:entradas,
          borderColor:'#22c55e',
          backgroundColor:'rgba(34,197,94,.15)',
          tension:.4
        },
        {
          label:'Saídas',
          data:saidas,
          borderColor:'#ef4444',
          backgroundColor:'rgba(239,68,68,.15)',
          tension:.4
        }
      ]
    },
    options:{
      plugins:{legend:{labels:{color:'#f5f5f5'}}},
      scales:{
        x:{ticks:{color:'#9ca3af'}},
        y:{ticks:{color:'#9ca3af'}}
      }
    }
  });
}

/* INIT */
aplicarFiltros();
</script>

</body>
</html>
